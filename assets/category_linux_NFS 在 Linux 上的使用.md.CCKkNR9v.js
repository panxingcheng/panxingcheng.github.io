import{_ as i,c as a,o as n,ag as h}from"./chunks/framework.BPIbAgMo.js";const g=JSON.parse('{"title":"NFS 在 Linux 上的使用","description":"","frontmatter":{"title":"NFS 在 Linux 上的使用","permalink":"1578558414.html","sidebar":"auto","blogs":"Linux","date":"2019-10-11"},"headers":[],"relativePath":"category/linux/NFS 在 Linux 上的使用.md","filePath":"category/linux/NFS 在 Linux 上的使用.md","lastUpdated":1714213745000}'),t={name:"category/linux/NFS 在 Linux 上的使用.md"};function l(p,s,k,e,F,r){return n(),a("div",null,s[0]||(s[0]=[h(`<h1 id="nfs-在-linux-上的使用" tabindex="-1">NFS 在 Linux 上的使用 <a class="header-anchor" href="#nfs-在-linux-上的使用" aria-label="Permalink to &quot;NFS 在 Linux 上的使用&quot;">​</a></h1><p>NFS 为 Network FileSystem 的简称，它的目的就是想让不同的机器、不同的操作系统可以彼此分享文件！</p><h2 id="nfs-server-端的设定" tabindex="-1">NFS Server 端的设定 <a class="header-anchor" href="#nfs-server-端的设定" aria-label="Permalink to &quot;NFS Server 端的设定&quot;">​</a></h2><h3 id="查看是否安装-nfs" tabindex="-1">查看是否安装 NFS <a class="header-anchor" href="#查看是否安装-nfs" aria-label="Permalink to &quot;查看是否安装 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qa</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qa</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcbind</span></span></code></pre></div><h3 id="安装-nfs" tabindex="-1">安装 NFS <a class="header-anchor" href="#安装-nfs" aria-label="Permalink to &quot;安装 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs-utils</span></span></code></pre></div><h3 id="配置-nfs" tabindex="-1">配置 NFS <a class="header-anchor" href="#配置-nfs" aria-label="Permalink to &quot;配置 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/exports</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/www/filestore/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.0/24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rw,sync,no_root_squash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[分享目录]      [IP网段(权限)]</span></span></code></pre></div><ul><li>权限常见参数值 (就是小括号内的参数)</li></ul><table tabindex="0"><thead><tr><th>参数值</th><th>内容说明</th></tr></thead><tbody><tr><td>rw<br>ro</td><td>该目录分享的权限是可擦写 (read-write) 或只读 (read-only)，但最终能不能读写，还是与文件系统的 rwx 及身份有关。</td></tr><tr><td>sync<br>async</td><td>sync 代表数据会同步写入到内存与硬盘中，async 则代表数据会先暂存于内存当中，而非直接写入硬盘！</td></tr><tr><td>no_root_squash<br>root_squash</td><td>客户端使用 NFS 文件系统的账号若为 root 时，系统该如何判断这个账号的身份？ 默认的情况下，客户端 root 的身份会由 root_squash 的设定压缩成 nfsnobody， 如此对服务器的系统会较有保障。 但如果你想要开放客户端使用 root 身份来操作服务器的文件系统，那么这里就得要开 no_root_squash 才行！</td></tr><tr><td>all_squash</td><td>不论登入 NFS 的用户身份为何， 他的身份都会被压缩成为匿名用户，通常也就是 nobody(nfsnobody) 啦！</td></tr><tr><td>anonuid<br>anongid</td><td>anon 意指 anonymous (匿名者) ，通常为 nobody(nfsnobody)，但是你可以自行设定这个 UID 的值！ 当然，这个 UID 必需要存在于你的 /etc/passwd 当中！ anonuid 指的是 UID 而 anongid 则是群组的 GID 啰。</td></tr></tbody></table><h3 id="启动-nfs" tabindex="-1">启动 NFS <a class="header-anchor" href="#启动-nfs" aria-label="Permalink to &quot;启动 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcbind</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span></span></code></pre></div><h3 id="查看-rpc-服务注册情况" tabindex="-1">查看 RPC 服务注册情况 <a class="header-anchor" href="#查看-rpc-服务注册情况" aria-label="Permalink to &quot;查看 RPC 服务注册情况&quot;">​</a></h3><blockquote><p>rpcinfo -p [IP|hostname]</p><p>rpcinfo -t|-u IP|hostname 程序名称</p><p>选项与参数：</p><p>-p ：针对某 IP (不写默认为本机) 显示出所有的 port 与 porgram 的信息；</p><p>-t ：针对某主机的某个程序检查其 TCP 封包所在的软件版本；</p><p>-u ：针对某主机的某个程序检查其 UDP 封包所在的软件版本；</p></blockquote><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示出目前本机的 RPC 状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcinfo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">program</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  portmapper</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mountd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100003</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100003</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100227</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs_acl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100003</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100003</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100227</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2049</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nfs_acl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">100021</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  30001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nlockmgr</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 程序代号 NFS 版本 封包类型 端口  服务名称</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 针对 nfs 这个程序检查其相关的软件版本信息 (仅察看 TCP 封包)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcinfo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">program</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100003</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> waiting</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">program</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100003</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> waiting</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以发现提供 nfs 的版本共有两种，分別是 3, 4</span></span></code></pre></div><h3 id="查看-nfs-状态" tabindex="-1">查看 NFS 状态 <a class="header-anchor" href="#查看-nfs-状态" aria-label="Permalink to &quot;查看 NFS 状态&quot;">​</a></h3><blockquote><p>showmount [-ae] [hostname|IP]</p><p>选项与参数：</p><p>-a ：显示目前主机与用戶端的 NFS 连线分享的状态；</p><p>-e ：显示某部主机的 /etc/exports 所分享的目录资料。</p></blockquote><ul><li>显示出刚刚我们所设定好的相关 exports 分享目录信息</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> showmount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.0/24</span></span></code></pre></div><h4 id="查看-nfs-默认参数" tabindex="-1">查看 NFS 默认参数 <a class="header-anchor" href="#查看-nfs-默认参数" aria-label="Permalink to &quot;查看 NFS 默认参数&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/nfs/etab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  192.168.0.0/24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rw,sync,wdelay,hide,nocrossmnt,secure,no_root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=65534,anongid=65534,sec=sys,rw,secure,no_root_squash,no_all_squash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="重新加载-nfs-配置文件" tabindex="-1">重新加载 NFS 配置文件 <a class="header-anchor" href="#重新加载-nfs-配置文件" aria-label="Permalink to &quot;重新加载 NFS 配置文件&quot;">​</a></h3><blockquote><p>exportfs [-aruv]</p><p>-a ：全部挂载(或卸载) /etc/exports 里面的设定</p><p>-r ：重新挂载 /etc/exports 裡面的設定，此外，亦同步更新 /etc/exports及 /var/lib/nfs/xtab 的內容！</p><p>-u ：卸載某一目錄</p><p>-v ：在 export 的時候，將分享的目錄顯示到螢幕上！</p></blockquote><ul><li>重新挂载一次 /etc/exports 的设定</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exportfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -arv</span></span></code></pre></div><ul><li>将已经分享的 NFS 目录资源，通通都卸载</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exportfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -auv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这时如果你再使用 showmount -e localhost 就会看不到任何资源了！</span></span></code></pre></div><h3 id="nfs-的安全性" tabindex="-1">NFS 的安全性 <a class="header-anchor" href="#nfs-的安全性" aria-label="Permalink to &quot;NFS 的安全性&quot;">​</a></h3><ul><li>NFS 端口的设定问题与解决方案：</li></ul><p>一般来说， NFS 的服务仅会对内部网域开放，不会对因特网开放的。 然而，如果你有特殊需求的话， 那么也可能会跨不同网域就是了。 但是，NFS 的防火墙特别难搞，为什么呢？ 因为除了固定的 port 111, 2049 之外， 还有很多不固定的端口是由 rpc.mountd, rpc.rquotad 等服务所开启的，所以，你的 iptables 就很难设定规则！ 那怎办？ 难道整个防火墙机制都要取消才可以？</p><p>为了解决这个问题， CentOS 7.x 有提供一个固定特定 NFS 服务的端口配置文件，那就是 /etc/sysconfig/nfs 啦！你在这个档案里面就能够指定特定的埠口，这样每次启动 nfs 时，相关服务启动的端口就会固定，如此一来， 我们就能够设定正确的防火墙啰！ 这个配置文件内容很多，绝大部分的数据你都不要去更改，只要改跟 PORT 这个关键词有关的数据即可。 那么需要更改的 rpc 服务有哪些呢？ 主要有 mountd, nlockmgr ，所以你应该要这样改：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysconfig/nfs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCKD_TCPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCKD_UDPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MOUNTD_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1002</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 记得去掉注释，端口的值你也可以自行決定。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #重新启动 NFS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcinfo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;(mount|nlock)&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #查看端口是否生效</span></span></code></pre></div><ul><li>开启防火墙</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=111/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=111/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=2049/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=2049/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=30001/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=30001/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=1002/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=1002/udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div><h2 id="nfs-客户端的设定" tabindex="-1">NFS 客户端的设定 <a class="header-anchor" href="#nfs-客户端的设定" aria-label="Permalink to &quot;NFS 客户端的设定&quot;">​</a></h2><h3 id="手动挂载-nfs-服务器分享的资源" tabindex="-1">手动挂载 NFS 服务器分享的资源 <a class="header-anchor" href="#手动挂载-nfs-服务器分享的资源" aria-label="Permalink to &quot;手动挂载 NFS 服务器分享的资源&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 rpcbind</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpcbind</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询服务器提供哪些资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> showmount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.0.204</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.204:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.0/24</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地建立挂载目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /www/filestore/204</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将本地目录挂载到服务器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.204:/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /cfs/204</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意一下挂载的语法！『 -t nfs 』指定目录系统类型，IP:/dir 則是指定某一部主机的某個提供的目錄！</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看挂载状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> df</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    Size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Avail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Use%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mounted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">中间省略</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">192.168.0.204:/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   46G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.5G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   44G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /www/filestore/204</span></span></code></pre></div><h3 id="nfs-挂载参数" tabindex="-1">NFS 挂载参数 <a class="header-anchor" href="#nfs-挂载参数" aria-label="Permalink to &quot;NFS 挂载参数&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bg,soft,rsize=32768,wsize=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32768</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.204:/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /cfs/204</span></span></code></pre></div><table tabindex="0"><thead><tr><th>参数</th><th>参数功能</th><th>默认参数</th></tr></thead><tbody><tr><td>fg<br>bg</td><td>当执行挂载时，该挂载的行为会在前景 (fg) 还是在背景 (bg) 执行？ 若在前景执行时，则 mount 会持续尝试挂载，直到成功或 time out 为止，若为背景执行， 则 mount 会在背景持续多次进行 mount ，而不会影响到前景的程序操作。 如果你的网络联机有点不稳定，或是服务器常常需要开关机，那建议使用 bg 比较妥当。</td><td>fg</td></tr><tr><td>soft<br>hard</td><td>如果是 hard 的情况，则当两者之间有任何一部主机脱机，则 RPC 会持续的呼叫，直到对方恢复联机为止。 如果是 soft 的话，那 RPC 会在 time out 后『重复』呼叫，而非『持续』呼叫， 因此系统的延迟会比较不这么明显。 同上，如果你的服务器可能开开关关，建议用 soft 喔！</td><td>hard</td></tr><tr><td>intr</td><td>当你使用上头提到的 hard 方式挂载时，若加上 intr 这个参数， 则当 RPC 持续呼叫中，该次的呼叫是可以被中断的 (interrupted)。</td><td>没有</td></tr><tr><td>rsize<br>wsize</td><td>读出(rsize)与写入(wsize)的区块大小 (block size)。 这个设定值可以影响客户端与服务器端传输数据的缓冲记忆容量。 一般来说， 如果在局域网络内 (LAN) ，并且客户端与服务器端都具有足够的内存，那这个值可以设定大一点， 比如说 32768 (bytes) 等，提升缓冲记忆区块将可提升 NFS 文件系统的传输能力！ 但要注意设定的值也不要太大，最好是达到网络能够传输的最大值为限。</td><td>rsize=1024<br>wsize=1024</td></tr></tbody></table><h3 id="卸载-nfs" tabindex="-1">卸载 NFS <a class="header-anchor" href="#卸载-nfs" aria-label="Permalink to &quot;卸载 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> umount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /www/filestore/204</span></span></code></pre></div><h3 id="开机自动挂载-nfs" tabindex="-1">开机自动挂载 NFS <a class="header-anchor" href="#开机自动挂载-nfs" aria-label="Permalink to &quot;开机自动挂载 NFS&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rc.d/rc.local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bg,soft,rsize=32768,wsize=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32768</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.0.204:/www/filestore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /cfs/204</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 必须确保 /etc/rc.d/rc.local 有执行权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rc.d/rc.local</span></span></code></pre></div>`,45)]))}const C=i(t,[["render",l]]);export{g as __pageData,C as default};
